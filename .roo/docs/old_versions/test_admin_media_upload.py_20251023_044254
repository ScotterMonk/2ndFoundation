# Created by Gemini 2.5 Pro | 2025-10-23
import os
from dotenv import load_dotenv

# Load environment variables from .env file
load_dotenv()

def test_admin_upload_image(client):
    """
    Tests the admin media upload functionality.
    """
    # 1. Login Logic
    admin_email = os.environ.get('ADMIN_EMAIL_45')
    admin_password = os.environ.get('ADMIN_PASSWORD_45')
    
    login_post_response = client.post('/auth/login', data={
        'email': admin_email,
        'password': admin_password
    }, follow_redirects=False)
    assert login_post_response.status_code == 302

    # 2. Upload Logic
    upload_page_response = client.get('/admin/media/upload')
    assert upload_page_response.status_code == 200

    # Prepare file for upload
    test_image_path = 'temp/test_image.png'
    with open(test_image_path, 'rb') as img:
        data = {
            'owner_id': '45',
            'media_type_id': '1',
            'file': (img, 'test_image.png')
        }
        
        upload_response = client.post(
            '/admin/media/upload',
            content_type='multipart/form-data',
            data=data,
            follow_redirects=False
        )

    # 3. Assertion
    assert upload_response.status_code == 302