{% extends "base.html" %}

{% block title %}Admin Dashboard - 2nd Foundation{% endblock %}

{% block content %}
<div class="container">
    <h1>Admin Dashboard</h1>
    
    <!-- Stats Overview -->
    <section class="admin-stats">
        <div class="stats-grid">
            <div class="stat-card">
                <div class="stat-icon">📚</div>
                <div class="stat-value">{{ stats.total_documents }}</div>
                <div class="stat-label">Total Documents</div>
            </div>
            
            <div class="stat-card">
                <div class="stat-icon">🔍</div>
                <div class="stat-value">{{ stats.total_searches }}</div>
                <div class="stat-label">Total Searches</div>
            </div>
            
            <div class="stat-card">
                <div class="stat-icon">🤖</div>
                <div class="stat-value">{{ stats.total_submissions }}</div>
                <div class="stat-label">Model Submissions</div>
            </div>
            
            <div class="stat-card">
                <div class="stat-icon">⚡</div>
                <div class="stat-value">{{ "%.3f"|format(stats.avg_search_time) }}s</div>
                <div class="stat-label">Avg Search Time</div>
            </div>
        </div>
    </section>

    <!-- Documents by Category -->
    <section class="admin-section">
        <h2>Documents by Category</h2>
        <div class="category-breakdown">
            {% for category, count in stats.by_category.items() %}
                <div class="category-bar">
                    <span class="category-label">{{ category.replace('_', ' ').title() }}</span>
                    <div class="category-progress">
                        <div class="category-fill" 
                             style="width: {{ (count / stats.total_documents * 100)|int }}%">
                        </div>
                    </div>
                    <span class="category-count">{{ count }}</span>
                </div>
            {% endfor %}
        </div>
    </section>

    <!-- Quick Actions -->
    <section class="admin-section">
        <h2>Quick Actions</h2>
        <div class="admin-actions">
            <a href="{{ url_for('admin.documents') }}" class="btn btn-primary">
                📄 Manage Documents
            </a>
            <a href="{{ url_for('admin.stats') }}" class="btn btn-secondary">
                📊 View Detailed Stats
            </a>
            <form action="{{ url_for('admin.reindex_all') }}" 
                  method="post" 
                  style="display: inline;"
                  onsubmit="return confirm('Reindex all documents? This may take a while.');">
                <button type="submit" class="btn btn-warning">
                    🔄 Reindex All Documents
                </button>
            </form>
            <form action="{{ url_for('admin.clear_cache') }}" 
                  method="post" 
                  style="display: inline;">
                <button type="submit" class="btn btn-warning">
                    🗑️ Clear Cache
                </button>
            </form>
        </div>
    </section>

    <!-- System Health -->
    <section class="admin-section">
        <h2>System Health</h2>
        <div class="health-indicators">
            <div class="health-item {% if stats.has_embeddings == stats.total_documents %}health-good{% else %}health-warning{% endif %}">
                <span class="health-label">Embeddings Coverage</span>
                <span class="health-value">
                    {{ stats.has_embeddings }}/{{ stats.total_documents }}
                </span>
            </div>
            <div class="health-item {% if stats.has_ts_vector == stats.total_documents %}health-good{% else %}health-warning{% endif %}">
                <span class="health-label">Full-Text Index Coverage</span>
                <span class="health-value">
                    {{ stats.has_ts_vector }}/{{ stats.total_documents }}
                </span>
            </div>
        </div>
    </section>
</div>
{% endblock %}